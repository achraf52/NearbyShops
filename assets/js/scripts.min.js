var csrfCookie,getLocation,alertBox,alertMsg,closeBtn,latitude,longitude;csrfCookie=Cookies.get('csrf_cookie');getLocation=$('#getLocation');alertBox=$('.alert');alertMsg=$('#alert');closeBtn=$('.close');function alertColor(index,className){return(className.match(/(^|\s)alert-\S+/g)||[]).join(' ')}
getLocation.click(function(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(position){latitude=position.coords.latitude;longitude=position.coords.longitude;if((latitude>=-90&&latitude<=90)&&(longitude>=-180&&longitude<=180)){latitude=Math.floor(latitude*1e8)/1e8;longitude=Math.floor(longitude*1e8)/1e8}else{alertBox.removeClass(alertColor);alertBox.removeClass('hidden');alertBox.addClass('alert-warning');alertMsg.html('Invalid location provided')}
if(typeof csrfCookie!=='undefined'){var request={'latitude':latitude,'longitude':longitude,'csrf_token':csrfCookie,};$.ajax({async:!0,type:'POST',url:'location',dataType:'text',data:request,}).done(function(response){response='success';if(response==='success'){alertBox.removeClass(alertColor);alertBox.removeClass('hidden');alertBox.addClass('alert-success');alertMsg.html('Location obtained successfully');location.reload()}else if(response==='error'){alertBox.removeClass(alertColor);alertBox.removeClass('hidden');alertBox.addClass('alert-danger');alertMsg.html('A server error has occurred')}})}else{alertBox.removeClass(alertColor);alertBox.removeClass('hidden');alertBox.addClass('alert-danger');alertMsg.html('Unable to read CSRF cookie')}},function(error){alertBox.removeClass(alertColor);alertBox.removeClass('hidden');alertBox.addClass('alert-danger');switch(error.code){case error.PERMISSION_DENIED:alertMsg.html('User denied the request for Geolocation');break;case error.POSITION_UNAVAILABLE:alertMsg.html('Location information is unavailable');break;case error.TIMEOUT:alertMsg.html('The request to get user location timed out');break;case error.UNKNOWN_ERROR:alertMsg.html('An unknown error occurred');break}})}else{alertBox.removeClass(alertColor);alertBox.removeClass('hidden');alertBox.addClass('alert-danger');alertMsg.html('Geolocation is not supported by this browser')}});closeBtn.click(function(){alertBox.addClass('hidden');alertBox.removeClass(alertColor);alertMsg.html('')})