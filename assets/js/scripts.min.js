var csrfCookie,getLocation,alertBox,alertMsg,closeBtn,latitude,longitude;csrfCookie=Cookies.get('csrf_cookie');getLocation=$('#getLocation');alertBox=$('.alert');alertMsg=$('#alert');closeBtn=$('.close');function alertColor(index,className){return(className.match(/(^|\s)alert-\S+/g)||[]).join(' ')}
function showAlert(type,message){alertBox.removeClass(alertColor);alertBox.removeClass('hidden');alertBox.addClass('alert-'+type);alertMsg.html(message)}
function checkLocation(latitude,longitude){if((latitude>=-90&&latitude<=90)&&(longitude>=-180&&longitude<=180)){return!0}else{showAlert('warning','Invalid location provided')}}
function submitLocation(latitude,longitude){var request={'latitude':latitude,'longitude':longitude,'csrf_token':csrfCookie,};$.ajax({async:!0,type:'POST',url:'location',dataType:'text',data:request,}).done(function(response){if(response==='success'){showAlert('success','Location obtained successfully');location.reload()}else if(response==='error'){showAlert('danger','A server error has occurred')}})}
getLocation.click(function(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(position){latitude=position.coords.latitude;longitude=position.coords.longitude;if(checkLocation(latitude,longitude)===!0){latitude=Math.floor(latitude*1e8)/1e8;longitude=Math.floor(longitude*1e8)/1e8;if(typeof csrfCookie!=='undefined'){submitLocation(latitude,longitude)}else{showAlert('danger','Unable to read CSRF cookie')}}},function(error){switch(error.code){case error.PERMISSION_DENIED:showAlert('danger','User denied the request for Geolocation');break;case error.POSITION_UNAVAILABLE:showAlert('danger','Location information is unavailable');break;case error.TIMEOUT:showAlert('danger','The request to get user location timed out');break;case error.UNKNOWN_ERROR:showAlert('danger','An unknown error occurred');break}})}else{showAlert('danger','Geolocation is not supported by this browser')}});closeBtn.click(function(){alertBox.addClass('hidden');alertBox.removeClass(alertColor);alertMsg.html('')})